-- Table: User
CREATE TABLE User (
    user_id CHAR(36) PRIMARY KEY, -- UUID
    username VARCHAR(50) NOT NULL,
    email VARCHAR(100) NOT NULL,
    password VARCHAR(255) NOT NULL,
    forename VARCHAR(50) NOT NULL,
    surname VARCHAR(50) NOT NULL,
    dob DATE NOT NULL,
    address TEXT NOT NULL,
    current_balance DECIMAL(65, 2) NOT NULL
);

-- Table: Security Questions
CREATE TABLE Security_Questions (
    user_id CHAR(36) NOT NULL,
    question VARCHAR(255) NOT NULL,
    answer VARCHAR(255) NOT NULL,
    FOREIGN KEY (user_id) REFERENCES User(user_id) ON DELETE CASCADE
);

-- Table: Budget
CREATE TABLE Budget (
    budget_name VARCHAR(100) NOT NULL,
    user_id CHAR(36) NOT NULL, -- UUID
    PRIMARY KEY (budget_name, user_id),
    FOREIGN KEY (user_id) REFERENCES User(user_id) ON DELETE CASCADE
);

-- Table: Budget Items
CREATE TABLE Budget_Items (
    item_name VARCHAR(100) NOT NULL,
    budget_name VARCHAR(100) NOT NULL,
    user_id CHAR(36) NOT NULL, -- UUID
    description TEXT,
    budget_cost DECIMAL(10, 2) NOT NULL,
    priority INT NOT NULL,
    PRIMARY KEY (item_name, budget_name, user_id),
    FOREIGN KEY (budget_name, user_id) REFERENCES Budget(budget_name, user_id) ON DELETE CASCADE
);

-- Table: Monthly Costs
CREATE TABLE Monthly_Costs (
    user_id CHAR(36) NOT NULL,
    month INT NOT NULL,
    year INT NOT NULL,
    item_name VARCHAR(255) NOT NULL,
    PRIMARY KEY (user_id, month, year, item_name),  -- Composite Primary Key to allow multiple items per month/year
    FOREIGN KEY (user_id) REFERENCES User(user_id) ON DELETE CASCADE,
    FOREIGN KEY (item_name, user_id) REFERENCES Budget_Items(item_name, user_id) ON DELETE CASCADE
);



-- Table: Transactions
CREATE TABLE Transactions (
    transaction_id CHAR(36) PRIMARY KEY, -- UUID
    user_id CHAR(36) NOT NULL, -- UUID
    transaction_name VARCHAR(100) NOT NULL,
    transaction_type VARCHAR(50) NOT NULL,
    amount DECIMAL(10, 2) NOT NULL,
    month INT NOT NULL,
    year INT NOT NULL,
    date DATE NOT NULL,
    FOREIGN KEY (user_id) REFERENCES User(user_id) ON DELETE CASCADE,
    FOREIGN KEY (month, year) REFERENCES Monthly_Costs(month, year) ON DELETE CASCADE
);